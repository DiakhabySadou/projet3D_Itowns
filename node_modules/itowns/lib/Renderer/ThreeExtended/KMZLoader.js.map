{"version":3,"sources":["../../../src/Renderer/ThreeExtended/KMZLoader.js"],"names":["THREE","KMZLoader","colladaLoader","ColladaLoader","options","convertUpAxis","cache","prototype","constructor","parseCollada","buffer","zip","collada","coordCarto","name","files","toLowerCase","substr","parse","file","asText","parser","DOMParser","doc","parseFromString","longitude","Number","getElementsByTagName","childNodes","nodeValue","latitude","altitude","coorCarto","load","url","fetch","then","response","status","Error","arrayBuffer"],"mappings":";;;;;;;;;;AAIA;;;;AACA;;IAAYA,K;;AACZ;;;;;;;;AAEA,SAASC,SAAT,GAAqB;AACjB,SAAKC,aAAL,GAAqB,IAAIF,MAAMG,aAAV,EAArB;AACA,SAAKD,aAAL,CAAmBE,OAAnB,CAA2BC,aAA3B,GAA2C,IAA3C;AACA,SAAKC,KAAL,GAAa,EAAb;AACH,C,CAZD;;;;AAcAL,UAAUM,SAAV,GAAsB,sBAAcN,UAAUM,SAAxB,CAAtB;;AAEAN,UAAUM,SAAV,CAAoBC,WAApB,GAAkCP,SAAlC;;AAEAA,UAAUM,SAAV,CAAoBE,YAApB,GAAmC,UAAsBC,MAAtB,EAA8B;AAC7D,QAAIC,MAAM,oBAAUD,MAAV,CAAV;AACA,QAAIE,OAAJ;AACA,QAAIC,UAAJ;;AAEA,SAAK,IAAIC,IAAT,IAAiBH,IAAII,KAArB,EAA4B;AACxB,YAAID,KAAKE,WAAL,GAAmBC,MAAnB,CAA0B,CAAC,CAA3B,MAAkC,MAAtC,EAA8C;AAC1CL,sBAAU,KAAKV,aAAL,CAAmBgB,KAAnB,CAAyBP,IAAIQ,IAAJ,CAASL,IAAT,EAAeM,MAAf,EAAzB,CAAV;AACH,SAFD,MAEO,IAAIN,KAAKE,WAAL,GAAmBC,MAAnB,CAA0B,CAAC,CAA3B,MAAkC,MAAtC,EAA8C;AACjD,gBAAII,SAAS,IAAIC,SAAJ,EAAb;AACA,gBAAIC,MAAMF,OAAOG,eAAP,CAAuBb,IAAIQ,IAAJ,CAASL,IAAT,EAAeM,MAAf,EAAvB,EAAgD,UAAhD,CAAV;;AAEA,gBAAIK,YAAYC,OAAOH,IAAII,oBAAJ,CAAyB,WAAzB,EAAsC,CAAtC,EAAyCC,UAAzC,CAAoD,CAApD,EAAuDC,SAA9D,CAAhB;AACA,gBAAIC,WAAWJ,OAAOH,IAAII,oBAAJ,CAAyB,UAAzB,EAAqC,CAArC,EAAwCC,UAAxC,CAAmD,CAAnD,EAAsDC,SAA7D,CAAf;AACA,gBAAIE,WAAWL,OAAOH,IAAII,oBAAJ,CAAyB,UAAzB,EAAqC,CAArC,EAAwCC,UAAxC,CAAmD,CAAnD,EAAsDC,SAA7D,CAAf;;AAEAhB,yBAAa,0BAAgB,WAAhB,EAA6BY,SAA7B,EAAwCK,QAAxC,EAAkDC,QAAlD,CAAb;AACH;AACJ;;AAEDnB,YAAQoB,SAAR,GAAoBnB,UAApB;AACA,WAAOD,OAAP;AACH,CAtBD;;AAwBAX,UAAUM,SAAV,CAAoB0B,IAApB,GAA2B,UAAcC,GAAd,EAAmB;AAAA;;AAC1C,WAAOC,MAAMD,GAAN,EAAWE,IAAX,CAAgB,UAACC,QAAD,EAAc;AACjC,YAAIA,SAASC,MAAT,GAAkB,GAAlB,IAAyBD,SAASC,MAAT,IAAmB,GAAhD,EAAqD;AACjD,kBAAM,IAAIC,KAAJ,oBAA2BL,GAA3B,iBAA0CG,SAASC,MAAnD,CAAN;AACH;AACD,eAAOD,SAASG,WAAT,EAAP;AACH,KALM,EAKJJ,IALI,CAKC;AAAA,eAAU,MAAK3B,YAAL,CAAkBC,MAAlB,CAAV;AAAA,KALD,CAAP;AAMH,CAPD;;kBASeT,S","file":"KMZLoader.js","sourcesContent":["/**\n * @author mrdoob / http://mrdoob.com/\n */\n\nimport JSZip from 'jszip';\nimport * as THREE from 'three';\nimport Coordinates from '../../Core/Geographic/Coordinates';\n\nfunction KMZLoader() {\n    this.colladaLoader = new THREE.ColladaLoader();\n    this.colladaLoader.options.convertUpAxis = true;\n    this.cache = [];\n}\n\nKMZLoader.prototype = Object.create(KMZLoader.prototype);\n\nKMZLoader.prototype.constructor = KMZLoader;\n\nKMZLoader.prototype.parseCollada = function parseCollada(buffer) {\n    var zip = new JSZip(buffer);\n    var collada;\n    var coordCarto;\n\n    for (var name in zip.files) {\n        if (name.toLowerCase().substr(-4) === '.dae') {\n            collada = this.colladaLoader.parse(zip.file(name).asText());\n        } else if (name.toLowerCase().substr(-4) === '.kml') {\n            var parser = new DOMParser();\n            var doc = parser.parseFromString(zip.file(name).asText(), 'text/xml');\n\n            var longitude = Number(doc.getElementsByTagName('longitude')[0].childNodes[0].nodeValue);\n            var latitude = Number(doc.getElementsByTagName('latitude')[0].childNodes[0].nodeValue);\n            var altitude = Number(doc.getElementsByTagName('altitude')[0].childNodes[0].nodeValue);\n\n            coordCarto = new Coordinates('EPSG:4326', longitude, latitude, altitude);\n        }\n    }\n\n    collada.coorCarto = coordCarto;\n    return collada;\n};\n\nKMZLoader.prototype.load = function load(url) {\n    return fetch(url).then((response) => {\n        if (response.status < 200 || response.status >= 300) {\n            throw new Error(`Error loading ${url}: status ${response.status}`);\n        }\n        return response.arrayBuffer();\n    }).then(buffer => this.parseCollada(buffer));\n};\n\nexport default KMZLoader;\n"]}