{"version":3,"sources":["../../../src/Renderer/ThreeExtended/FirstPersonControls.js"],"names":["THREE","onDocumentMouseDown","event","pointerX","pointerY","preventDefault","_isMouseDown","_onMouseDownMouseX","_onMouseDownMouseY","_stateOnMouseDown","_state","snapshot","limitRotation","camera3D","rot","verticalFOV","limit","Math","degToRad","fov","clamp","onPointerMove","pxToAngleRatio","camera","view","mainLoop","gfxEngine","height","rotateY","rotateX","options","applyRotation","state","quaternion","setFromUnitVectors","Vector3","up","notifyChange","onDocumentMouseWheel","delta","wheelDelta","undefined","detail","min","updateProjectionMatrix","onDocumentMouseUp","onKeyUp","e","move","MOVEMENTS","keyCode","moves","delete","onKeyDown","add","method","sign","FirstPersonControls","panoramaRatio","radius","PI","radToDeg","atan","moveSpeed","self","q","Quaternion","inverse","r","clone","premultiply","Euler","setFromQuaternion","x","y","domElement","renderer","bindedPD","bind","addEventListener","clientX","clientY","touches","pageX","pageY","bindedPM","addFrameRequester","focusOnMouseOver","focus","focusOnClick","size","dt","updateLoopRestarted","position","z","EventDispatcher"],"mappings":"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","file":"FirstPersonControls.js","sourcesContent":["import * as THREE from 'three';\n\n// Note: we could use existing three.js controls (like https://github.com/mrdoob/three.js/blob/dev/examples/js/controls/FirstPersonControls.js)\n// but including these controls in itowns allows use to integrate them tightly with itowns.\n// Especially the existing controls are expecting a continuous update loop while we have a pausable one (so our controls use .notifyChange when needed)\n\n\n// Mouse movement handling\nfunction onDocumentMouseDown(event, pointerX, pointerY) {\n    event.preventDefault();\n    this._isMouseDown = true;\n\n    this._onMouseDownMouseX = pointerX;\n    this._onMouseDownMouseY = pointerY;\n\n    this._stateOnMouseDown = this._state.snapshot();\n}\n\nfunction limitRotation(camera3D, rot, verticalFOV) {\n    // Limit vertical rotation (look up/down) to make sure the user cannot see\n    // outside of the cone defined by verticalFOV\n    const limit = THREE.Math.degToRad(verticalFOV - camera3D.fov) * 0.5;\n    return THREE.Math.clamp(rot, -limit, limit);\n}\n\nfunction onPointerMove(pointerX, pointerY) {\n    if (this._isMouseDown === true) {\n        // in rigor we have tan(theta) = tan(cameraFOV) * deltaH / H\n        // (where deltaH is the vertical amount we moved, and H the renderer height)\n        // we loosely approximate tan(x) by x\n        const pxToAngleRatio = THREE.Math.degToRad(this.camera.fov) / this.view.mainLoop.gfxEngine.height;\n\n        // update state based on pointer movement\n        this._state.rotateY = ((pointerX - this._onMouseDownMouseX) * pxToAngleRatio) + this._stateOnMouseDown.rotateY;\n        this._state.rotateX = limitRotation(\n            this.camera,\n            ((pointerY - this._onMouseDownMouseY) * pxToAngleRatio) + this._stateOnMouseDown.rotateX,\n        this.options.verticalFOV);\n\n        applyRotation(this.view, this.camera, this._state);\n    }\n}\n\nfunction applyRotation(view, camera3D, state) {\n    camera3D.quaternion.setFromUnitVectors(\n        new THREE.Vector3(0, 1, 0), camera3D.up);\n\n    camera3D.rotateY(state.rotateY);\n    camera3D.rotateX(state.rotateX);\n\n    view.notifyChange(true, camera3D);\n}\n\n// Mouse wheel\nfunction onDocumentMouseWheel(event) {\n    let delta = 0;\n    if (event.wheelDelta !== undefined) {\n        delta = -event.wheelDelta;\n    // Firefox\n    } else if (event.detail !== undefined) {\n        delta = event.detail;\n    }\n\n    this.camera.fov =\n        THREE.Math.clamp(this.camera.fov + Math.sign(delta),\n            10,\n            Math.min(100, this.options.verticalFOV));\n\n    this.camera.updateProjectionMatrix();\n\n    this._state.rotateX = limitRotation(\n        this.camera,\n        this._state.rotateX,\n        this.options.verticalFOV);\n\n    applyRotation(this.view, this.camera, this._state);\n}\n\nfunction onDocumentMouseUp() {\n    this._isMouseDown = false;\n}\n\n// Keyboard handling\nfunction onKeyUp(e) {\n    const move = MOVEMENTS[e.keyCode];\n    if (move) {\n        this.moves.delete(move);\n        this.view.notifyChange(true);\n        e.preventDefault();\n    }\n}\n\nfunction onKeyDown(e) {\n    const move = MOVEMENTS[e.keyCode];\n    if (move) {\n        this.moves.add(move);\n        this.view.notifyChange(false);\n        e.preventDefault();\n    }\n}\n\nconst MOVEMENTS = {\n    38: { method: 'translateZ', sign: -1 }, // FORWARD: up key\n    40: { method: 'translateZ', sign: 1 }, // BACKWARD: down key\n    37: { method: 'translateX', sign: -1 }, // STRAFE_LEFT: left key\n    39: { method: 'translateX', sign: 1 }, // STRAFE_RIGHT: right key\n    33: { method: 'translateY', sign: 1 }, // UP: PageUp key\n    34: { method: 'translateY', sign: -1 }, // DOWN: PageDown key\n};\n\n\nclass FirstPersonControls extends THREE.EventDispatcher {\n    /**\n     * @Constructor\n     * @param {View} view\n     * @param {object} options\n     * @param {boolean} options.focusOnClick - whether or not to focus the renderer domElement on click\n     * @param {boolean} options.focusOnMouseOver - whether or not to focus when the mouse is over the domElement\n     * @param {boolean} options.moveSpeed - if > 0, pressing the arrow keys will move the camera\n     * @param {number} options.verticalFOV - define the max visible vertical angle of the scene in degrees (default 180)\n     * @param {number} options.panoramaRatio - alternative way to specify the max vertical angle when using a panorama.\n     * You can specify the panorama width/height ratio and the verticalFOV will be computed automatically\n     */\n    constructor(view, options = {}) {\n        super();\n        this.camera = view.camera.camera3D;\n        this.view = view;\n        this.moves = new Set();\n        if (options.panoramaRatio) {\n            const radius = (options.panoramaRatio * 200) / (2 * Math.PI);\n            options.verticalFOV =\n                options.panoramaRatio == 2 ? 180 : THREE.Math.radToDeg(2 * Math.atan(200 / (2 * radius)));\n        }\n        options.verticalFOV = options.verticalFOV || 180;\n        options.moveSpeed = options.moveSpeed === undefined ? 10 : options.moveSpeed; // backward or forward move speed in m/s\n        this.options = options;\n\n        this._isMouseDown = false;\n        this._onMouseDownMouseX = 0;\n        this._onMouseDownMouseY = 0;\n\n        const self = this;\n        this._state = {\n\n            snapshot() {\n                // Compute the correct init state, given the calculus in applyRotation:\n                // cam.quaternion = q * r\n                // => r = inverse(q) * cam.quaterion\n                // q is the quaternion derived from the up vector\n                const q = new THREE.Quaternion().setFromUnitVectors(\n                    new THREE.Vector3(0, 1, 0), self.camera.up);\n                q.inverse();\n                // compute r\n                const r = self.camera.quaternion.clone().premultiply(q);\n                // tranform it to euler\n                const e = new THREE.Euler(0, 0, 0, 'YXZ').setFromQuaternion(r);\n                // and use it as the initial state\n                this.rotateX = e.x;\n                this.rotateY = e.y;\n                return { rotateX: this.rotateX, rotateY: this.rotateY };\n            },\n        };\n        this._state.snapshot();\n\n        const domElement = view.mainLoop.gfxEngine.renderer.domElement;\n        const bindedPD = onDocumentMouseDown.bind(this);\n        domElement.addEventListener('mousedown', e => bindedPD(e, e.clientX, e.clientY), false);\n        domElement.addEventListener('touchstart', e => bindedPD(e, e.touches[0].pageX, e.touches[0].pageY), false);\n        const bindedPM = onPointerMove.bind(this);\n        domElement.addEventListener('mousemove', e => bindedPM(e.clientX, e.clientY), false);\n        domElement.addEventListener('touchmove', e => bindedPM(e.touches[0].pageX, e.touches[0].pageY), false);\n        domElement.addEventListener('mouseup', onDocumentMouseUp.bind(this), false);\n        domElement.addEventListener('touchend', onDocumentMouseUp.bind(this), false);\n        domElement.addEventListener('keyup', onKeyUp.bind(this), true);\n        domElement.addEventListener('keydown', onKeyDown.bind(this), true);\n        domElement.addEventListener('mousewheel', onDocumentMouseWheel.bind(this), false);\n        domElement.addEventListener('DOMMouseScroll', onDocumentMouseWheel.bind(this), false); // firefox\n\n        this.view.addFrameRequester(this);\n\n        // focus policy\n        if (options.focusOnMouseOver) {\n            domElement.addEventListener('mouseover', () => domElement.focus());\n        }\n        if (options.focusOnClick) {\n            domElement.addEventListener('click', () => domElement.focus());\n        }\n    }\n\n    isUserInteracting() {\n        return this.moves.size !== 0 && !this._isMouseDown;\n    }\n\n    update(dt, updateLoopRestarted) {\n        // if we are in a keypressed state, then update position\n\n        // dt will not be relevant when we just started rendering, we consider a 1-frame move in this case\n        if (updateLoopRestarted) {\n            dt = 16;\n        }\n\n        for (const move of this.moves) {\n            if (move.method === 'translateY') {\n                this.camera.position.z += move.sign * this.options.moveSpeed * dt / 1000;\n            } else {\n                this.camera[move.method](move.sign * this.options.moveSpeed * dt / 1000);\n            }\n        }\n\n        if (this.moves.size || this._isMouseDown) {\n            this.view.notifyChange(true);\n        }\n    }\n}\n\nexport default FirstPersonControls;\n"]}